<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Workway</title>
    <style>
        /* Einfaches Design für die Buttons */
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            cursor: pointer;
            margin-left: 10px;
            border-radius: 5px;
        }
        button:hover {
            background-color: #45a049;
        }
        #result {
            margin-top: 20px;
            font-size: 20px;
        }
        .place-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        .place-item input {
            margin-right: 10px;
            padding: 5px;
        }
    </style>
</head>
<body>
    <h1>Arbeitsweg Rechner</h1>
    <div id="placesInputContainer">
        <div class="place-item">
            <input type="text" id="placesInput" placeholder="Gib die Orte ein, z.B. Olpe, Siegen, Kirchveischede">
            <button onclick="calculateRoute()">Berechnen</button>
        </div>
    </div>

    <div id="placesList">
        <!-- Die Orte werden hier als Liste erscheinen -->
    </div>

    <div id="result">
        <!-- Das Ergebnis der Routenberechnung wird hier erscheinen -->
    </div>

    <script>
        // Die Kopieren-Funktion
        function copyToClipboard(text) {
            const tempInput = document.createElement("input");
            tempInput.value = text;
            document.body.appendChild(tempInput);
            tempInput.select();
            document.execCommand("copy");
            document.body.removeChild(tempInput);
            alert("Kopiert: " + text);
        }

        // Berechnung der Route und der Distanzen
        function calculateRoute() {
            const inputField = document.getElementById('placesInput');
            const places = inputField.value.split(',').map(place => place.trim());

            if (places.length < 2) {
                alert("Bitte mindestens zwei Orte eingeben!");
                return;
            }

            const coordinates = [];
            for (let i = 0; i < places.length; i++) {
                const place = places[i];
                const coords = getCoordinatesFromGeoJson(place);
                if (coords) {
                    coordinates.push(coords);
                } else {
                    alert(`Kein Ergebnis für: ${place}`);
                }
            }

            if (coordinates.length === places.length) {
                let totalDistance = 0;
                for (let i = 0; i < coordinates.length - 1; i++) {
                    const start = coordinates[i];
                    const end = coordinates[i + 1];

                    getRoute(start, end, (distance) => {
                        totalDistance += distance;
                        if (i === coordinates.length - 2) {
                            displayResult(totalDistance);
                        }
                    });
                }
            }
        }

        // Holen der Koordinaten für die Orte aus der GeoJSON
        function getCoordinatesFromGeoJson(placeName) {
            const geojson = window.geojsonData; // Annahme: Die GeoJSON-Daten sind global verfügbar
            const feature = geojson.features.find(f => f.properties.name.toLowerCase() === placeName.toLowerCase());
            if (feature) {
                return feature.geometry.coordinates;
            }
            return null;
        }

        // Holen der Route und Berechnung der Distanz
        function getRoute(startCoords, endCoords, callback) {
            const url = `https://api.openstreetmap.org/routing/v1/route?start=${startCoords[1]},${startCoords[0]}&end=${endCoords[1]},${endCoords[0]}&format=json`;
            
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    const distance = data.routes[0].legs[0].distance / 1000; // in km
                    callback(distance);
                })
                .catch(error => {
                    console.error('Fehler beim Abrufen der Route:', error);
                });
        }

        // Das Ergebnis der Berechnung anzeigen
        function displayResult(totalDistance) {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = `
                Die gesamte Entfernung beträgt: ${totalDistance.toFixed(2)} km
                <button onclick="copyToClipboard('${totalDistance.toFixed(2)} km')">Kopieren</button>
            `;
        }

        // Dynamisches Erstellen der Liste der Orte und Kopier-Buttons
        function updatePlaceList(places) {
            const placesListDiv = document.getElementById('placesList');
            placesListDiv.innerHTML = '';  // Liste zurücksetzen
            places.forEach((place, index) => {
                const placeDiv = document.createElement('div');
                placeDiv.classList.add('place-item');
                placeDiv.innerHTML = `
                    <input type="text" value="${place}" readonly>
                    <button onclick="copyToClipboard('${place}')">Kopieren</button>
                    <button onclick="removePlace(${index})">Löschen</button>
                `;
                placesListDiv.appendChild(placeDiv);
            });
        }

        // Ort löschen
        function removePlace(index) {
            const inputField = document.getElementById('placesInput');
            const places = inputField.value.split(',').map(place => place.trim());
            places.splice(index, 1);
            inputField.value = places.join(', ');
            updatePlaceList(places);
        }

        // Den Code nach der Berechnung aufrufen, um die Orte anzuzeigen
        document.getElementById('placesInput').addEventListener('input', function() {
            const places = this.value.split(',').map(place => place.trim());
            updatePlaceList(places);
        });
    </script>
</body>
</html>
