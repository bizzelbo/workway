<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arbeitsweg Rechner</title>
    <style>
        /* Einfaches Design für die Buttons */
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            cursor: pointer;
            margin-left: 10px;
            border-radius: 5px;
        }
        button:hover {
            background-color: #45a049;
        }
        #result {
            margin-top: 20px;
            font-size: 20px;
        }
        #placesInputContainer {
            margin-bottom: 20px;
        }
        .placesInputRow {
            display: flex;
            align-items: center;
        }
        .placesInputRow input {
            margin-right: 10px;
            padding: 5px;
        }
    </style>
</head>
<body>
    <h1>Arbeitsweg Rechner</h1>
    <div id="placesInputContainer" class="placesInputRow">
        <input type="text" id="placesInput" placeholder="Gib die Orte ein, z.B. Olpe, Siegen, Kirchveischede">
        <button onclick="calculateRoute()">Berechnen</button>
        <button onclick="copyPlaces()">Kopieren Orte</button>
    </div>

    <div id="result">
        <!-- Das Ergebnis der Berechnung wird hier erscheinen -->
    </div>

    <div id="map" style="height: 400px; width: 100%; margin-top: 20px;"></div>

    <script>
        let geojsonData = {};  // Hier wird später das GeoJSON geladen
        let markers = []; // Array für die Marker

        // Funktion zum Laden der GeoJSON-Daten
        function loadGeoJson() {
            fetch('Kreis_siegen_Sauerland.geojson')  // Pfad zur GeoJSON-Datei
                .then(response => response.json())
                .then(data => {
                    geojsonData = data;
                    console.log('GeoJSON geladen:', geojsonData);
                    initMap();  // Initialisiere die Karte nach dem Laden der GeoJSON-Daten
                })
                .catch(error => {
                    console.error('Fehler beim Laden der GeoJSON-Datei:', error);
                });
        }

        // Berechnung der Route und der Distanzen
        function calculateRoute() {
            const inputField = document.getElementById('placesInput');
            const places = inputField.value.split(',').map(place => place.trim());

            if (places.length < 2) {
                alert("Bitte mindestens zwei Orte eingeben!");
                return;
            }

            const coordinates = [];
            for (let i = 0; i < places.length; i++) {
                const place = places[i];
                const coords = getCoordinatesFromGeoJson(place);
                if (coords) {
                    coordinates.push(coords);
                } else {
                    alert(`Kein Ergebnis für: ${place}`);
                    return;
                }
            }

            let totalDistance = 0;
            let routePromises = [];
            for (let i = 0; i < coordinates.length - 1; i++) {
                const start = coordinates[i];
                const end = coordinates[i + 1];

                routePromises.push(
                    getRoute(start, end).then(distance => {
                        totalDistance += distance;
                    }).catch(err => {
                        console.error("Fehler bei der Routenberechnung:", err);
                    })
                );
            }

            Promise.all(routePromises).then(() => {
                if (totalDistance > 0) {
                    displayResult(totalDistance);
                } else {
                    alert("Es konnte keine gültige Route berechnet werden.");
                }
            });
        }

        // Holen der Koordinaten für die Orte aus der GeoJSON
        function getCoordinatesFromGeoJson(placeName) {
            const feature = geojsonData.features.find(f => f.properties.name.toLowerCase() === placeName.toLowerCase());
            if (feature) {
                return feature.geometry.coordinates;
            }
            return null;
        }

        // Holen der Route und Berechnung der Distanz mit OpenRouteService API
        function getRoute(startCoords, endCoords) {
            const apiKey = '5b3ce3597851110001cf62484340a966fc4945bfa57ce8995c8e89f2';  // Dein API-Schlüssel für OpenRouteService

            const url = `https://api.openrouteservice.org/v2/directions/driving-car?api_key=${apiKey}&start=${startCoords[0]},${startCoords[1]}&end=${endCoords[0]},${endCoords[1]}`;

            return fetch(url)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`API Fehler: ${response.statusText}`);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('API Antwort:', data);
                    if (data.routes && data.routes.length > 0 && data.routes[0].segments.length > 0) {
                        const distance = data.routes[0].segments[0].distance / 1000; // in km
                        return distance;
                    } else {
                        throw new Error('Keine Route gefunden oder keine Distanzen verfügbar.');
                    }
                })
                .catch(error => {
                    console.error('Fehler beim Abrufen der Route:', error);
                    return 0; // im Fehlerfall 0 zurückgeben
                });
        }

        // Das Ergebnis der Berechnung anzeigen
        function displayResult(totalDistance) {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = `
                Die gesamte Entfernung beträgt: ${totalDistance.toFixed(2)} km
                <button onclick="copyToClipboard('${totalDistance.toFixed(2)} km')">Kopieren</button>
            `;
        }

        // Die Kopieren-Funktion
        function copyToClipboard(text) {
            const tempInput = document.createElement("input");
            tempInput.value = text;
            document.body.appe
